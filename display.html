<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Monitor Antrean - RS YARSI</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { 
            background-color: #000; 
            color: #fff; 
            height: 100vh; 
            margin: 0; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-family: 'Arial Black', sans-serif;
            overflow: hidden;
        }
        .monitor-box { 
            border: 20px solid #0d6efd; 
            border-radius: 60px; 
            padding: 80px; 
            background: radial-gradient(circle, #111 0%, #000 100%); 
            width: 95%; 
            box-shadow: 0 0 100px rgba(13,110,253,0.5);
            text-align: center;
        }
        .label-panggilan {
            letter-spacing: 15px;
            color: #0d6efd;
            font-size: 40px;
            font-weight: bold;
            text-transform: uppercase;
        }
        .nomor-antrean { 
            font-size: 350px; 
            color: #ffc107; 
            line-height: 1; 
            margin: 40px 0;
            text-shadow: 0 0 50px rgba(255,193,7,0.3);
        }
        .nama-pasien { 
            font-size: 100px; 
            text-transform: uppercase; 
            border-top: 6px solid #222; 
            padding-top: 30px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .poli-tujuan { 
            font-size: 60px; 
            color: #0dcaf0; 
            margin-top: 20px;
        }
    </style>
</head>
<body onclick="alert('AUDIO AKTIF - Monitor Siap Digunakan')">

    <div class="monitor-box">
        <div class="label-panggilan">Panggilan Antrean</div>
        <div id="noDisp" class="nomor-antrean">--</div>
        <div id="namaDisp" class="nama-pasien">STAND BY</div>
        <div id="poliDisp" class="poli-tujuan">Menunggu Panggilan...</div>
    </div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script>
    const firebaseConfig = {
        apiKey: "AIzaSy...", 
        authDomain: "sistem-pasien-yarsi.firebaseapp.com",
        databaseURL: "https://sistem-pasien-yarsi-default-rtdb.asia-southeast1.firebasedatabase.app/",
        projectId: "sistem-pasien-yarsi",
        storageBucket: "sistem-pasien-yarsi.appspot.com",
        messagingSenderId: "...",
        appId: "..."
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Variable untuk mencegah pengulangan saat database update hal lain
    let lastCallId = 0;

    db.ref('panggilan_suara').on('value', function(snapshot) {
        const d = snapshot.val();
        if(!d || d.waktu === lastCallId) return;
        
        lastCallId = d.waktu;

        // Update Tampilan Visual
        document.getElementById("noDisp").innerText = d.nomor;
        document.getElementById("namaDisp").innerText = d.nama;
        document.getElementById("poliDisp").innerText = "SILAHKAN MENUJU KE POLI " + d.poli.toUpperCase();

        // JALANKAN PROSES SUARA (TANPA TEROMPET)
        jalankanSuara(d.nomor, d.nama, d.poli);
    });

    function jalankanSuara(nomor, nama, poli) {
        // Hentikan suara yang sedang berjalan jika ada
        window.speechSynthesis.cancel();

        // Persiapan Teks (Eja nomor agar robot tidak bingung)
        const ejaNomor = nomor.split('').join(' ').replace('-', ' ');
        const teksPanggilan = `Nomor antrean ${ejaNomor}, atas nama ${nama}, silahkan menuju poli ${poli}`;

        const speech = new SpeechSynthesisUtterance(teksPanggilan);
        speech.lang = 'id-ID';
        speech.rate = 0.8; // Kecepatan bicara (sedikit lambat agar jelas)
        speech.pitch = 1.1; // Nada suara

        // Panggilan Pertama
        window.speechSynthesis.speak(speech);

        // Panggilan Kedua (Setelah panggilan pertama selesai)
        speech.onend = function() {
            // Beri jeda 2 detik sebelum panggil ulang
            setTimeout(function() {
                window.speechSynthesis.speak(speech);
            }, 2000);
            
            // Hapus event end agar tidak memicu loop ketiga
            speech.onend = null;
        };
    }
</script>
</body>
</html>